<!DOCTYPE html>
<html lang="pt" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERLIM | Perfil Lingu√≠stico Multidimensional</title>
    <meta name="description" content="Ferramenta profissional de avalia√ß√£o lingu√≠stica baseada no modelo conceptual da linguagem oral (Alves, 2019)">
    <meta name="author" content="Joana Miguel / CAIDI">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>A carregar...</p>
    </div>

    <!-- Ecr√£ de Login (Split Layout) -->
    <div id="login-screen" class="login-screen">
        <!-- Lado Esquerdo - Branding -->
        <div class="login-brand">
            <div class="login-brand-content">
                <img src="logo-branco.png" alt="CAIDI" class="login-logo">
                <h1>PERLIM</h1>
                <p class="login-brand-subtitle">Perfil Lingu√≠stico Multidimensional</p>
                <p class="login-brand-description">
                    Ferramenta profissional para caracteriza√ß√£o, leitura e interpreta√ß√£o 
                    de perfis lingu√≠sticos de forma multidimensional.
                </p>
                <p class="login-brand-credits">
                    <strong>Modelo conceptual:</strong> Alves (2019)<br>
                    <strong>Operacionaliza√ß√£o:</strong> Joana Miguel<br>
                    CAIDI ¬∑ CLUNL
                </p>
            </div>
            <!-- Decora√ß√£o radar -->
            <div class="login-radar-decoration">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="0.5"/>
                    <circle cx="50" cy="50" r="35" fill="none" stroke="white" stroke-width="0.5"/>
                    <circle cx="50" cy="50" r="25" fill="none" stroke="white" stroke-width="0.5"/>
                    <circle cx="50" cy="50" r="15" fill="none" stroke="white" stroke-width="0.5"/>
                    <line x1="50" y1="5" x2="50" y2="95" stroke="white" stroke-width="0.3"/>
                    <line x1="5" y1="50" x2="95" y2="50" stroke="white" stroke-width="0.3"/>
                </svg>
            </div>
        </div>

        <!-- Lado Direito - Formul√°rio -->
        <div class="login-form-side">
            <div class="login-form-header">
                <h2>Bem-vindo</h2>
                <p>Entre na sua conta para continuar</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" data-tab="login">Entrar</button>
                <button class="login-tab" data-tab="register">Criar conta</button>
            </div>

            <form id="login-form">
                <div class="form-group" id="login-nome-group" style="display:none">
                    <label for="login-nome">Nome</label>
                    <input type="text" id="login-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="email@exemplo.com" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <div class="form-error" id="login-error"></div>
                <button type="submit" class="btn btn-primary btn-block btn-lg" id="login-submit">Entrar</button>
            </form>

            <p class="login-info">
                Ferramenta de apoio √† caracteriza√ß√£o do perfil lingu√≠stico e √† decis√£o cl√≠nica.
            </p>

            <div class="login-form-footer">
                <p>¬© 2025 Joana Miguel ¬∑ Todos os direitos reservados</p>
            </div>
        </div>
    </div>

    <!-- App Content (escondido at√© login) -->
    <div id="app-content" class="app-content" style="display:none">

        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="logo-branco.png" alt="CAIDI" class="logo-img">
                    <div class="logo-text">
                        <h1>PERLIM</h1>
                        <p>Perfil Lingu√≠stico Multidimensional</p>
                    </div>
                </div>
                <nav class="header-nav">
                    <button class="btn-icon" id="btn-gestao" title="Gest√£o de Casos (G)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v4h-7zM14 10h7v11h-7zM3 13h7v8H3z"/></svg>
                    </button>
                    <button class="btn-icon" id="btn-info" title="Informa√ß√µes (I)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                    </button>
                    <button class="btn-icon" id="btn-theme" title="Alternar Tema (T)">
                        <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                        <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                    </button>
                    <button class="btn-icon" id="btn-fullscreen" title="Ecr√£ Completo (F)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>
                    </button>
                    <div class="user-menu" id="user-menu">
                        <button class="btn-icon btn-user" id="btn-user" title="Utilizador">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            <span class="user-name" id="user-name"></span>
                        </button>
                        <div class="user-dropdown" id="user-dropdown">
                            <div class="user-info" id="user-info"></div>
                            <button class="dropdown-item" id="btn-logout">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg>
                                Terminar Sess√£o
                            </button>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Identifica√ß√£o -->
                <section class="card" id="card-identificacao">
                    <div class="card-header">
                        <h2 class="card-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            Identifica√ß√£o
                        </h2>
                        <button class="btn-mini btn-crianca" id="btn-load-case" title="Selecionar / Nova Crian√ßa">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="caso-id">C√≥digo</label>
                                <input type="text" id="caso-id" placeholder="C001" data-testid="caso-id">
                            </div>
                            <div class="form-group">
                                <label for="caso-idade">Idade</label>
                                <input type="text" id="caso-idade" placeholder="7;4" data-testid="caso-idade">
                                <span class="input-hint">Formato: anos;meses</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="caso-nome">Nome</label>
                            <input type="text" id="caso-nome" placeholder="Nome do caso" data-testid="caso-nome">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="caso-data">Data</label>
                                <input type="date" id="caso-data" data-testid="caso-data">
                            </div>
                            <div class="form-group">
                                <label for="caso-esc">Ano Escolar</label>
                                <select id="caso-esc" data-testid="caso-esc">
                                    <option value="">Selecione</option>
                                    <option value="pre">Pr√©-escolar</option>
                                    <option value="1">1¬∫ ano</option>
                                    <option value="2">2¬∫ ano</option>
                                    <option value="3">3¬∫ ano</option>
                                    <option value="4">4¬∫ ano+</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="caso-aval">Avaliador</label>
                            <input type="text" id="caso-aval" placeholder="TF" data-testid="caso-aval">
                        </div>
                        <div class="info-box" id="esc-info" style="display:none">
                            <span id="esc-msg"></span>
                        </div>
                    </div>
                </section>

                <!-- Dados de Entrada -->
                <section class="card" id="card-dados">
                    <div class="card-header">
                        <h2 class="card-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            Dados
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="tabs" role="tablist">
                            <button class="tab active" data-tab="seg" role="tab" aria-selected="true">Por Segmento</button>
                            <button class="tab" data-tab="prova" role="tab" aria-selected="false">Por Prova</button>
                        </div>

                        <!-- Tab Segmento -->
                        <div id="tab-seg" class="tab-content active">
                            <div class="module-tabs">
                                <button class="mod-tab active" data-mod="0" style="--mod-color: var(--mod-fono)">Fono</button>
                                <button class="mod-tab" data-mod="1" style="--mod-color: var(--mod-morf)">Morf</button>
                                <button class="mod-tab" data-mod="2" style="--mod-color: var(--mod-sint)">Sint</button>
                                <button class="mod-tab" data-mod="3" style="--mod-color: var(--mod-sem)">Sem</button>
                                <button class="mod-tab" data-mod="4" style="--mod-color: var(--mod-prag)">Prag</button>
                            </div>
                            <div id="mod-panels"></div>
                        </div>

                        <!-- Tab Prova -->
                        <div id="tab-prova" class="tab-content">
                            <div class="form-group">
                                <label for="prova-sel">Prova</label>
                                <select id="prova-sel" data-testid="prova-sel">
                                    <option value="">Selecione uma prova</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prova-esc">Escala</label>
                                    <select id="prova-esc" data-testid="prova-esc">
                                        <option value="perc">Percentil</option>
                                        <option value="qi">QI</option>
                                        <option value="z">Nota Z</option>
                                        <option value="t">Nota T</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prova-val">Valor</label>
                                    <input type="number" id="prova-val" placeholder="25" data-testid="prova-val">
                                </div>
                            </div>
                            <div class="conversion-display" id="conversion-display">
                                <span class="conversion-label">Compet√™ncia:</span>
                                <span class="conversion-value" id="conversion-value">‚Äî</span>
                            </div>
                            <button class="btn btn-primary btn-block" id="btn-add-prova" data-testid="btn-add-prova">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14m-7-7h14"/></svg>
                                Adicionar Resultado
                            </button>
                            <div id="tarefas-container"></div>
                            <div id="prova-list" class="prova-list"></div>
                        </div>
                    </div>
                </section>

                <!-- Ac√ß√µes -->
                <section class="card" id="card-acoes">
                    <div class="card-body">
                        <button class="btn btn-primary btn-block btn-lg" id="btn-gerar" data-testid="btn-gerar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            Gerar Perfil
                        </button>
                        <div class="btn-group">
                            <button class="btn btn-secondary" id="btn-limpar" title="Limpar (Ctrl+L)" data-testid="btn-limpar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                                Limpar
                            </button>
                            <button class="btn btn-secondary" id="btn-guardar" title="Guardar na Cloud (Ctrl+S)" data-testid="btn-guardar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                                Guardar
                            </button>
                            <button class="btn btn-secondary" id="btn-exemplo" title="Carregar Exemplo (E)" data-testid="btn-exemplo">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8m2-8H8"/></svg>
                                Exemplo
                            </button>
                            <button class="btn btn-secondary" id="btn-export" title="Exportar (Ctrl+E)" data-testid="btn-export">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                Exportar
                            </button>
                        </div>
                    </div>
                </section>
            </aside>

            <!-- Main Content Area -->
            <section class="content">
                <!-- Radar Chart -->
                <div class="radar-card" id="radar-card">
                    <div class="radar-header">
                        <div class="radar-title-wrap">
                            <h2 id="radar-title">Perfil Lingu√≠stico Multidimensional</h2>
                            <span class="radar-subtitle" id="radar-subtitle"></span>
                        </div>
                        <div class="radar-actions">
                            <button class="btn-icon btn-sm btn-close-fullscreen" id="btn-close-fullscreen" title="Sair do Ecr√£ Completo (ESC)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                            </button>
                            <button class="btn-icon btn-sm" id="btn-zoom-in" title="Ampliar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35M11 8v6m-3-3h6"/></svg>
                            </button>
                            <button class="btn-icon btn-sm" id="btn-zoom-out" title="Reduzir">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35M8 11h6"/></svg>
                            </button>
                            <button class="btn-icon btn-sm" id="btn-download-png" title="Descarregar PNG">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="radar-body">
                        <div class="radar-wrap" id="radar-wrap">
                            <canvas id="radar-canvas" width="800" height="800"></canvas>
                        </div>
                    </div>
                    <div class="radar-legend">
                        <div class="legend-section">
                            <h4>Zonas de Refer√™ncia</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-color zone-red"></span>
                                    <span>0-3: Dificuldade Acentuada</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color zone-yellow"></span>
                                    <span>3-5: Dificuldade Moderada</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color zone-white"></span>
                                    <span>5-10: Desempenho T√≠pico</span>
                                </div>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>An√©is Hier√°rquicos</h4>
                            <div class="legend-items">
                                <div class="legend-item"><span class="legend-color" style="background:var(--caidi-turquesa)"></span><span>Dom√≠nio Lingu√≠stico</span></div>
                                <div class="legend-item"><span class="legend-color" style="background:#A5D6A7"></span><span>N√≠vel de Processamento</span></div>
                                <div class="legend-item"><span class="legend-color" style="background:#90CAF9"></span><span>Circuito</span></div>
                                <div class="legend-item"><span class="legend-color" style="background:#E0E0E0"></span><span>Modalidade</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="stats-dashboard" id="stats-dashboard" style="display:none">
                    <h3 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
                        Resumo Estat√≠stico
                    </h3>
                    <div class="stats-grid" id="stats-grid"></div>
                </div>

                <!-- Analysis Panel -->
                <div class="analysis-panel" id="analysis" style="display:none">
                    <h3 class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        An√°lise Cl√≠nica
                    </h3>
                    
                    <div class="analysis-section">
                        <h4>Padr√µes Identificados</h4>
                        <div id="patterns"></div>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>Hip√≥teses Diagn√≥sticas</h4>
                        <div class="disclaimer">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><path d="M12 9v4m0 4h.01"/></svg>
                            Estas hip√≥teses requerem confirma√ß√£o atrav√©s de avalia√ß√£o cl√≠nica completa.
                        </div>
                        <div id="hypotheses"></div>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>Prioridades de Interven√ß√£o</h4>
                        <div id="intervention"></div>
                        <button class="btn btn-sm btn-ia" id="btn-abrir-ia" style="margin-top:1rem">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                            ü§ñ Gerar Plano com IA
                        </button>
                    </div>

                    <div class="analysis-section">
                        <h4>Perfil por Dimens√£o</h4>
                        <div id="dimension-charts"></div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-left">
                    <img src="logo.png" alt="CAIDI" class="footer-logo">
                    <div class="footer-text">
                        <p><strong>PERLIM</strong></p>
                        <p>Perfil Lingu√≠stico Multidimensional</p>
                    </div>
                </div>
                <div class="footer-center">
                    <p>Desenvolvido por <strong>Joana Miguel</strong></p>
                    <p>CAIDI ¬∑ CLUNL</p>
                </div>
                <div class="footer-right">
                    <p class="version">v3.1</p>
                    <p>Janeiro 2025</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 Joana Miguel ¬∑ Todos os direitos reservados</p>
                <p class="shortcuts-hint">Atalhos: <kbd>G</kbd> Gest√£o ¬∑ <kbd>E</kbd> Exemplo ¬∑ <kbd>T</kbd> Tema ¬∑ <kbd>F</kbd> Ecr√£ completo</p>
            </div>
        </footer>

        <!-- Modals -->
        <!-- History Modal -->
        <!-- PAINEL DE GEST√ÉO UNIFICADO -->
        <div class="modal" id="modal-gestao">
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v4h-7zM14 10h7v11h-7zM3 13h7v8H3z"/></svg>
                        Gest√£o de Casos
                    </h2>
                    <button class="btn-close" data-close>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="modal-body gestao-body">
                    <!-- Tabs de navega√ß√£o -->
                    <div class="gestao-tabs">
                        <button class="gestao-tab active" data-gestao-tab="visao-geral">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9M13 17V5M8 17v-3"/></svg>
                            Vis√£o Geral
                        </button>
                        <button class="gestao-tab" data-gestao-tab="criancas">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>
                            Crian√ßas
                        </button>
                        <button class="gestao-tab" data-gestao-tab="avaliacoes">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8"/></svg>
                            Avalia√ß√µes
                        </button>
                        <button class="gestao-tab" data-gestao-tab="evolucao">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                            Evolu√ß√£o
                        </button>
                        <button class="gestao-tab" data-gestao-tab="exportacao">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                            Importar/Exportar
                        </button>
                    </div>
                    
                    <!-- Conte√∫do das tabs -->
                    <div class="gestao-content">
                        <!-- TAB: Vis√£o Geral -->
                        <div class="gestao-panel active" id="panel-visao-geral">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">üë∂</div>
                                    <div class="stat-value" id="stat-criancas">0</div>
                                    <div class="stat-label">Crian√ßas</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üìä</div>
                                    <div class="stat-value" id="stat-avaliacoes">0</div>
                                    <div class="stat-label">Avalia√ß√µes</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üìÖ</div>
                                    <div class="stat-value" id="stat-mes">0</div>
                                    <div class="stat-label">Este M√™s</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üéØ</div>
                                    <div class="stat-value" id="stat-media">-</div>
                                    <div class="stat-label">M√©dia Global</div>
                                </div>
                            </div>
                            
                            <div class="visao-grid">
                                <div class="visao-section">
                                    <h4>Distribui√ß√£o por Faixa Et√°ria</h4>
                                    <div class="chart-container" id="chart-idades"></div>
                                </div>
                                <div class="visao-section">
                                    <h4>Dom√≠nios com Mais Dificuldades</h4>
                                    <div class="chart-container" id="chart-dominios"></div>
                                </div>
                            </div>
                            
                            <div class="visao-section">
                                <h4>Avalia√ß√µes Recentes</h4>
                                <div class="avaliacoes-recentes" id="avaliacoes-recentes"></div>
                            </div>
                        </div>
                        
                        <!-- TAB: Crian√ßas -->
                        <div class="gestao-panel" id="panel-criancas">
                            <div class="panel-toolbar">
                                <input type="text" id="pesquisa-criancas" placeholder="Pesquisar por nome ou c√≥digo..." class="search-input">
                                <select id="filtro-criancas-idade" class="filter-select">
                                    <option value="">Todas as idades</option>
                                    <option value="0-3">0-3 anos</option>
                                    <option value="3-6">3-6 anos</option>
                                    <option value="6-10">6-10 anos</option>
                                    <option value="10+">10+ anos</option>
                                </select>
                                <button class="btn btn-primary" onclick="abrirNovaCrianca()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                                    Nova Crian√ßa
                                </button>
                            </div>
                            <div class="criancas-lista" id="gestao-criancas-lista"></div>
                        </div>
                        
                        <!-- TAB: Avalia√ß√µes -->
                        <div class="gestao-panel" id="panel-avaliacoes">
                            <div class="panel-toolbar">
                                <input type="text" id="pesquisa-avaliacoes" placeholder="Pesquisar avalia√ß√µes..." class="search-input">
                                <select id="filtro-crianca" class="filter-select">
                                    <option value="">Todas as crian√ßas</option>
                                </select>
                                <input type="date" id="filtro-data-de" class="filter-date" title="De">
                                <input type="date" id="filtro-data-ate" class="filter-date" title="At√©">
                            </div>
                            <div class="avaliacoes-lista" id="gestao-avaliacoes-lista"></div>
                            <div class="panel-footer">
                                <label class="checkbox-inline">
                                    <input type="checkbox" id="seleccionar-todas-avaliacoes">
                                    Seleccionar todas
                                </label>
                                <div class="footer-actions">
                                    <button class="btn btn-secondary" id="btn-comparar-seleccionados" disabled>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
                                        Comparar
                                    </button>
                                    <button class="btn btn-secondary" id="btn-exportar-seleccionados" disabled>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                        Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- TAB: Evolu√ß√£o -->
                        <div class="gestao-panel" id="panel-evolucao">
                            <div class="panel-toolbar">
                                <select id="evolucao-crianca" class="filter-select filter-select-lg">
                                    <option value="">Seleccionar crian√ßa...</option>
                                </select>
                            </div>
                            <div class="evolucao-content" id="evolucao-content">
                                <div class="evolucao-placeholder">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                                    <p>Seleccione uma crian√ßa para ver a evolu√ß√£o das avalia√ß√µes</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- TAB: Importar/Exportar -->
                        <div class="gestao-panel" id="panel-exportacao">
                            <div class="export-sections">
                                <div class="export-section">
                                    <h4>
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 002-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                                        Importar Dados
                                    </h4>
                                    <p class="text-muted">Importar avalia√ß√µes de ficheiros externos</p>
                                    <div class="import-options">
                                        <button class="btn btn-secondary btn-import" id="btn-import-json">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                                            Importar JSON
                                        </button>
                                        <button class="btn btn-secondary btn-import" id="btn-import-excel">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13h2m4 0h2M8 17h2m4 0h2"/></svg>
                                            Importar Excel
                                        </button>
                                    </div>
                                    <input type="file" id="input-import-file" accept=".json,.xlsx,.xls" style="display:none">
                                </div>
                                
                                <div class="export-section">
                                    <h4>
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                        Exportar Dados
                                    </h4>
                                    <p class="text-muted">Exportar dados para an√°lise externa</p>
                                    
                                    <div class="export-filters">
                                        <div class="filter-group">
                                            <label>Per√≠odo</label>
                                            <div class="date-range">
                                                <input type="date" id="export-data-de">
                                                <span>at√©</span>
                                                <input type="date" id="export-data-ate">
                                            </div>
                                        </div>
                                        <div class="filter-group">
                                            <label>Crian√ßas</label>
                                            <select id="export-criancas" multiple class="multi-select">
                                                <option value="todas" selected>Todas</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="export-options">
                                        <button class="btn btn-primary btn-export" id="btn-export-excel">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13h2m4 0h2M8 17h2m4 0h2"/></svg>
                                            Excel (.xlsx)
                                        </button>
                                        <button class="btn btn-secondary btn-export" id="btn-export-csv">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                                            CSV
                                        </button>
                                        <button class="btn btn-secondary btn-export" id="btn-export-json-all">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                                            JSON
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Modal -->
        <div class="modal" id="modal-info">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                        Informa√ß√µes
                    </h2>
                    <button class="btn-close" data-close>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="info-tabs">
                        <button class="info-tab active" data-info="provas">L√©xico de Provas</button>
                        <button class="info-tab" data-info="conversao">Tabela de Convers√£o</button>
                        <button class="info-tab" data-info="modelo">Modelo Te√≥rico</button>
                        <button class="info-tab" data-info="atalhos">Atalhos</button>
                    </div>
                    <div id="info-content" class="info-content"></div>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div class="modal" id="modal-export">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Exportar Perfil
                    </h2>
                    <button class="btn-close" data-close>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="export-options">
                        <button class="export-option" data-export="png">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                            <span>PNG</span>
                            <small>Imagem do radar</small>
                        </button>
                        <button class="export-option" data-export="pdf">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8m2-8H8"/></svg>
                            <span>PDF</span>
                            <small>Para impress√£o</small>
                        </button>
                        <button class="export-option" data-export="word">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><text x="7" y="17" font-size="7" font-weight="bold" fill="currentColor">W</text></svg>
                            <span>Word</span>
                            <small>Relat√≥rio narrativo</small>
                        </button>
                        <button class="export-option" data-export="json">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                            <span>JSON</span>
                            <small>Dados estruturados</small>
                        </button>
                        <button class="export-option" data-export="csv">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13h2m4 0h2M8 17h2m4 0h2"/></svg>
                            <span>CSV</span>
                            <small>Folha de c√°lculo</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar Prova Aplicada -->
        <div class="modal" id="modal-editar-prova">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Editar Prova Aplicada</h3>
                    <button class="modal-close" data-close>&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Prova</label>
                        <input type="text" id="edit-prova-nome" readonly class="input-readonly">
                    </div>
                    <div class="form-group">
                        <label>Valor Obtido</label>
                        <input type="number" id="edit-prova-valor" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Escala</label>
                        <select id="edit-prova-escala">
                            <option value="z">Pontua√ß√£o Z</option>
                            <option value="t">Pontua√ß√£o T</option>
                            <option value="pc">Percentil</option>
                            <option value="pe">Pontua√ß√£o Escalar</option>
                            <option value="qi">QI/Standard</option>
                            <option value="comp">Compet√™ncia (0-10)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Compet√™ncia Calculada</label>
                        <input type="text" id="edit-prova-comp" readonly class="input-readonly">
                    </div>
                    <input type="hidden" id="edit-prova-idx">
                    <div class="modal-actions">
                        <button class="btn btn-secondary" data-close>Cancelar</button>
                        <button class="btn btn-primary" id="btn-salvar-edicao-prova">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar Prova Custom -->
        <div class="modal" id="modal-editar-prova-custom">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>Editar Prova Personalizada</h3>
                    <button class="modal-close" data-close>&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome da Prova</label>
                            <input type="text" id="edit-custom-nome" placeholder="Ex: Prova de Nomea√ß√£o">
                        </div>
                        <div class="form-group">
                            <label>Escala</label>
                            <select id="edit-custom-escala">
                                <option value="z">Pontua√ß√£o Z</option>
                                <option value="t">Pontua√ß√£o T</option>
                                <option value="pc">Percentil</option>
                                <option value="pe">Pontua√ß√£o Escalar</option>
                                <option value="qi">QI/Standard</option>
                                <option value="comp">Compet√™ncia (0-10)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Dom√≠nio Principal</label>
                        <select id="edit-custom-dominio">
                            <option value="Fonol√≥gico">Fonol√≥gico</option>
                            <option value="Morfol√≥gico">Morfol√≥gico</option>
                            <option value="Sint√°tico">Sint√°tico</option>
                            <option value="Sem√¢ntico">Sem√¢ntico</option>
                            <option value="Pragm√°tico">Pragm√°tico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Segmentos Avaliados</label>
                        <div class="segmentos-grid" id="edit-custom-segmentos"></div>
                    </div>
                    <input type="hidden" id="edit-custom-id">
                    <div class="modal-actions">
                        <button class="btn btn-secondary" data-close>Cancelar</button>
                        <button class="btn btn-danger" id="btn-eliminar-prova-custom">Eliminar</button>
                        <button class="btn btn-primary" id="btn-salvar-prova-custom">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Gerar Plano IA -->
        <div class="modal" id="modal-ia">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>ü§ñ Plano Terap√™utico com IA</h3>
                    <button class="modal-close" data-close>&times;</button>
                </div>
                <div class="modal-body">
                    <div class="ia-intro">
                        <p>O sistema ir√° analisar o perfil lingu√≠stico e gerar um plano terap√™utico personalizado. <strong>Nota:</strong> Esta funcionalidade requer configura√ß√£o adicional.</p>
                    </div>
                    <div class="form-group">
                        <label>Contexto Adicional (opcional)</label>
                        <textarea id="ia-contexto" rows="3" placeholder="Informa√ß√µes adicionais relevantes: hist√≥ria cl√≠nica, observa√ß√µes, objectivos espec√≠ficos da fam√≠lia..."></textarea>
                    </div>
                    <div class="ia-loading" id="ia-loading" style="display:none">
                        <div class="loading-spinner"></div>
                        <p>A gerar plano terap√™utico...</p>
                    </div>
                    <div class="ia-result" id="ia-result" style="display:none"></div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" data-close>Cancelar</button>
                        <button class="btn btn-primary" id="btn-gerar-plano-ia">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm0 18a8 8 0 118-8 8 8 0 01-8 8z"/><path d="M12 6v6l4 2"/></svg>
                            Gerar Plano
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Compara√ß√£o Temporal -->
        <div class="modal" id="modal-comparacao">
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h3>üìà Evolu√ß√£o Temporal</h3>
                    <button class="modal-close" data-close>&times;</button>
                </div>
                <div class="modal-body">
                    <div class="comparacao-container" id="comparacao-container">
                        <p class="text-muted">Seleccione um caso com hist√≥rico para ver a evolu√ß√£o.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Auth (legacy) -->
        <div class="modal" id="modal-auth">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="auth-title">Entrar</h3>
                    <button class="modal-close" data-close>&times;</button>
                </div>
                <div class="modal-body">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-auth="login">Entrar</button>
                        <button class="auth-tab" data-auth="register">Criar Conta</button>
                    </div>
                    <form id="auth-form">
                        <div class="form-group" id="auth-nome-group" style="display:none">
                            <label>Nome</label>
                            <input type="text" id="auth-nome" placeholder="O seu nome">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="auth-email" placeholder="email@exemplo.com" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div>
                        <div class="form-error" id="auth-error"></div>
                        <button type="submit" class="btn btn-primary btn-block" id="auth-submit">Entrar</button>
                    </form>
                    <p class="auth-info">
                        <small>Os seus dados ficam guardados de forma segura no servidor.</small>
                    </p>
                </div>
            </div>
        </div>

        <!-- Modal Nova Crian√ßa -->
        <div class="modal" id="modal-crianca">
            <div class="modal-content modal-xl">
                <div class="modal-header">
                    <h2>üë§ Ficha da Crian√ßa</h2>
                    <button class="btn-close" data-close>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form-crianca">
                        <!-- C√≥digo autom√°tico -->
                        <div class="crianca-codigo" id="crianca-codigo-display">
                            <span class="codigo-label">C√≥digo:</span>
                            <span class="codigo-valor" id="crianca-codigo">Ser√° gerado automaticamente</span>
                        </div>

                        <!-- Identifica√ß√£o b√°sica -->
                        <fieldset class="form-section">
                            <legend>Identifica√ß√£o</legend>
                            <div class="form-row-3">
                                <div class="form-group">
                                    <label for="crianca-nome">Nome completo *</label>
                                    <input type="text" id="crianca-nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="crianca-dn">Data de nascimento *</label>
                                    <input type="date" id="crianca-dn" required>
                                </div>
                                <div class="form-group">
                                    <label for="crianca-sexo">Sexo</label>
                                    <select id="crianca-sexo">
                                        <option value="">Selecione</option>
                                        <option value="M">Masculino</option>
                                        <option value="F">Feminino</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row-3">
                                <div class="form-group">
                                    <label for="crianca-lateralidade">Lateralidade</label>
                                    <select id="crianca-lateralidade">
                                        <option value="">Selecione</option>
                                        <option value="Destro">Destro</option>
                                        <option value="Esquerdino">Esquerdino/Canhoto</option>
                                        <option value="Ambidestro">Ambidestro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="crianca-escola">Escola/JI</label>
                                    <input type="text" id="crianca-escola">
                                </div>
                                <div class="form-group">
                                    <label for="crianca-ano">Ano escolar</label>
                                    <select id="crianca-ano">
                                        <option value="">Selecione</option>
                                        <option value="Creche">Creche</option>
                                        <option value="JI 3 anos">JI - 3 anos</option>
                                        <option value="JI 4 anos">JI - 4 anos</option>
                                        <option value="JI 5 anos">JI - 5 anos</option>
                                        <option value="1¬∫ ano">1¬∫ ano</option>
                                        <option value="2¬∫ ano">2¬∫ ano</option>
                                        <option value="3¬∫ ano">3¬∫ ano</option>
                                        <option value="4¬∫ ano">4¬∫ ano</option>
                                        <option value="5¬∫ ano">5¬∫ ano</option>
                                        <option value="6¬∫ ano">6¬∫ ano</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="crianca-linguas">L√≠ngua(s) falada(s) em casa</label>
                                <input type="text" id="crianca-linguas" placeholder="Ex: Portugu√™s, Crioulo">
                            </div>
                        </fieldset>

                        <!-- Desenvolvimento -->
                        <fieldset class="form-section collapsible">
                            <legend class="collapsible-header" onclick="toggleSection(this)">
                                <span>‚ñº Desenvolvimento</span>
                            </legend>
                            <div class="collapsible-content">
                                <div class="form-row-3">
                                    <div class="form-group">
                                        <label for="crianca-palavras">Primeiras palavras</label>
                                        <input type="text" id="crianca-palavras" placeholder="Ex: 12 meses">
                                    </div>
                                    <div class="form-group">
                                        <label for="crianca-frases">Primeiras frases</label>
                                        <input type="text" id="crianca-frases" placeholder="Ex: 24 meses">
                                    </div>
                                    <div class="form-group">
                                        <label for="crianca-passos">Primeiros passos</label>
                                        <input type="text" id="crianca-passos" placeholder="Ex: 13 meses">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="crianca-preocupacoes">Preocupa√ß√µes com o desenvolvimento?</label>
                                    <textarea id="crianca-preocupacoes" rows="2" placeholder="Descreva se houve preocupa√ß√µes..."></textarea>
                                </div>
                            </div>
                        </fieldset>

                        <!-- Antecedentes Cl√≠nicos -->
                        <fieldset class="form-section collapsible">
                            <legend class="collapsible-header" onclick="toggleSection(this)">
                                <span>‚ñº Antecedentes Cl√≠nicos</span>
                            </legend>
                            <div class="collapsible-content">
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-prematuridade" onchange="toggleSubfield(this, 'ac-prematuridade-sem')">
                                        <span>Prematuridade</span>
                                        <input type="text" id="ac-prematuridade-sem" class="subfield" placeholder="semanas" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-audicao">
                                        <span>Problemas de audi√ß√£o</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-visao">
                                        <span>Problemas de vis√£o</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-neurologico">
                                        <span>Perturba√ß√£o neurol√≥gica</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-genetico">
                                        <span>Perturba√ß√£o gen√©tica/s√≠ndrome</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-phda">
                                        <span>PHDA</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-pea">
                                        <span>PEA</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="ac-outro" onchange="toggleSubfield(this, 'ac-outro-desc')">
                                        <span>Outro</span>
                                        <input type="text" id="ac-outro-desc" class="subfield" placeholder="Especifique" disabled>
                                    </label>
                                </div>
                            </div>
                        </fieldset>

                        <!-- Acompanhamentos -->
                        <fieldset class="form-section collapsible">
                            <legend class="collapsible-header" onclick="toggleSection(this)">
                                <span>‚ñº Acompanhamentos</span>
                            </legend>
                            <div class="collapsible-content">
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-tf" onchange="toggleSubfield(this, 'acomp-tf-desde')">
                                        <span>Terapia da Fala</span>
                                        <input type="text" id="acomp-tf-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-psic" onchange="toggleSubfield(this, 'acomp-psic-desde')">
                                        <span>Psicologia</span>
                                        <input type="text" id="acomp-psic-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-to" onchange="toggleSubfield(this, 'acomp-to-desde')">
                                        <span>Terapia Ocupacional</span>
                                        <input type="text" id="acomp-to-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-fisio" onchange="toggleSubfield(this, 'acomp-fisio-desde')">
                                        <span>Fisioterapia</span>
                                        <input type="text" id="acomp-fisio-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-pedopsiq" onchange="toggleSubfield(this, 'acomp-pedopsiq-desde')">
                                        <span>Pedopsiquiatria</span>
                                        <input type="text" id="acomp-pedopsiq-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-neuroped" onchange="toggleSubfield(this, 'acomp-neuroped-desde')">
                                        <span>Neuropediatria</span>
                                        <input type="text" id="acomp-neuroped-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-apoio" onchange="toggleSubfield(this, 'acomp-apoio-desde')">
                                        <span>Apoio educativo</span>
                                        <input type="text" id="acomp-apoio-desde" class="subfield" placeholder="desde" disabled>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="acomp-outro" onchange="toggleSubfield(this, 'acomp-outro-desc')">
                                        <span>Outro</span>
                                        <input type="text" id="acomp-outro-desc" class="subfield" placeholder="Qual e desde" disabled>
                                    </label>
                                </div>
                            </div>
                        </fieldset>

                        <!-- Antecedentes Familiares -->
                        <fieldset class="form-section collapsible">
                            <legend class="collapsible-header" onclick="toggleSection(this)">
                                <span>‚ñº Antecedentes Familiares</span>
                            </legend>
                            <div class="collapsible-content">
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="af-linguagem">
                                        <span>Dificuldades de linguagem</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="af-leitura">
                                        <span>Dificuldades de leitura</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="af-escrita">
                                        <span>Dificuldades de escrita</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="af-aprendizagem">
                                        <span>Dificuldades de aprendizagem</span>
                                    </label>
                                </div>
                                <div class="form-group" style="margin-top:1rem">
                                    <label for="af-quem">Grau de parentesco</label>
                                    <input type="text" id="af-quem" placeholder="Ex: pai, tio materno">
                                </div>
                            </div>
                        </fieldset>

                        <!-- Diagn√≥stico e Notas -->
                        <fieldset class="form-section">
                            <legend>Diagn√≥stico e Notas</legend>
                            <div class="form-group">
                                <label for="crianca-diagnostico">Diagn√≥stico / Hip√≥tese diagn√≥stica</label>
                                <input type="text" id="crianca-diagnostico" placeholder="Ex: PDL, Atraso de linguagem">
                            </div>
                            <div class="form-group">
                                <label for="crianca-notas">Notas / Observa√ß√µes</label>
                                <textarea id="crianca-notas" rows="3" placeholder="Outras informa√ß√µes relevantes..."></textarea>
                            </div>
                        </fieldset>

                        <input type="hidden" id="crianca-id">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-close>Cancelar</button>
                    <button type="button" class="btn btn-primary btn-guardar-destaque" id="btn-guardar-crianca">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Guardar Crian√ßa
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal Seleccionar Crian√ßa -->
        <div class="modal" id="modal-seleccionar-crianca">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2>üë§ Seleccionar Crian√ßa</h2>
                    <button class="btn-close" data-close>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="crianca-actions">
                        <input type="text" id="crianca-search" placeholder="Pesquisar por nome ou c√≥digo..." class="search-input">
                        <button class="btn btn-primary" id="btn-nova-crianca">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14m-7-7h14"/></svg>
                            Nova Crian√ßa
                        </button>
                    </div>
                    <div id="lista-criancas" class="lista-criancas">
                        <p class="text-muted">A carregar...</p>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- Fim do app-content -->

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/data.js"></script>
    <script src="js/radar.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
