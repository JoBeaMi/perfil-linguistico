<!DOCTYPE html>
<html lang="pt" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Compet√™ncia Lingu√≠stica | CAIDI</title>
    <meta name="description" content="Ferramenta profissional de avalia√ß√£o lingu√≠stica baseada nos Quadrantes de Alves (2019)">
    <meta name="author" content="Joana Miguel / CAIDI">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>A carregar...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo-branco.png" alt="CAIDI" class="logo-img">
                <div class="logo-text">
                    <h1>Perfil de Compet√™ncia Lingu√≠stica</h1>
                    <p>Quadrantes de Alves (2019) ¬∑ Operacionaliza√ß√£o: J. Miguel</p>
                </div>
            </div>
            <nav class="header-nav">
                <button class="btn-icon" id="btn-dashboard" title="Dashboard">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                </button>
                <button class="btn-icon" id="btn-history" title="Hist√≥rico de Casos (H)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
                <button class="btn-icon" id="btn-info" title="Informa√ß√µes (I)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                </button>
                <button class="btn-icon" id="btn-theme" title="Alternar Tema (T)">
                    <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                    <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                </button>
                <button class="btn-icon" id="btn-fullscreen" title="Ecr√£ Completo (F)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>
                </button>
                <div class="user-menu" id="user-menu">
                    <button class="btn-icon btn-user" id="btn-user" title="Utilizador">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <span class="user-name" id="user-name"></span>
                    </button>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-info" id="user-info"></div>
                        <button class="dropdown-item" id="btn-logout">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg>
                            Terminar Sess√£o
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Identifica√ß√£o -->
            <section class="card" id="card-identificacao">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Identifica√ß√£o
                    </h2>
                    <button class="btn-mini" id="btn-load-case" title="Carregar caso">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 002-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                    </button>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="caso-id">C√≥digo</label>
                            <input type="text" id="caso-id" placeholder="C001" data-testid="caso-id">
                        </div>
                        <div class="form-group">
                            <label for="caso-idade">Idade</label>
                            <input type="text" id="caso-idade" placeholder="7;4" data-testid="caso-idade">
                            <span class="input-hint">Formato: anos;meses</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="caso-nome">Nome</label>
                        <input type="text" id="caso-nome" placeholder="Nome do caso" data-testid="caso-nome">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="caso-data">Data</label>
                            <input type="date" id="caso-data" data-testid="caso-data">
                        </div>
                        <div class="form-group">
                            <label for="caso-esc">Ano Escolar</label>
                            <select id="caso-esc" data-testid="caso-esc">
                                <option value="">Selecione</option>
                                <option value="pre">Pr√©-escolar</option>
                                <option value="1">1¬∫ ano</option>
                                <option value="2">2¬∫ ano</option>
                                <option value="3">3¬∫ ano</option>
                                <option value="4">4¬∫ ano+</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="caso-aval">Avaliador</label>
                        <input type="text" id="caso-aval" placeholder="TF" data-testid="caso-aval">
                    </div>
                    <div class="info-box" id="esc-info" style="display:none">
                        <span id="esc-msg"></span>
                    </div>
                </div>
            </section>

            <!-- Dados de Entrada -->
            <section class="card" id="card-dados">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        Dados
                    </h2>
                </div>
                <div class="card-body">
                    <div class="tabs" role="tablist">
                        <button class="tab active" data-tab="seg" role="tab" aria-selected="true">Por Segmento</button>
                        <button class="tab" data-tab="prova" role="tab" aria-selected="false">Por Prova</button>
                    </div>

                    <!-- Tab Segmento -->
                    <div id="tab-seg" class="tab-content active">
                        <div class="module-tabs">
                            <button class="mod-tab active" data-mod="0" style="--mod-color: var(--mod-fono)">Fono</button>
                            <button class="mod-tab" data-mod="1" style="--mod-color: var(--mod-morf)">Morf</button>
                            <button class="mod-tab" data-mod="2" style="--mod-color: var(--mod-sint)">Sint</button>
                            <button class="mod-tab" data-mod="3" style="--mod-color: var(--mod-sem)">Sem</button>
                            <button class="mod-tab" data-mod="4" style="--mod-color: var(--mod-prag)">Prag</button>
                        </div>
                        <div id="mod-panels"></div>
                    </div>

                    <!-- Tab Prova -->
                    <div id="tab-prova" class="tab-content">
                        <div class="form-group">
                            <label for="prova-sel">Prova</label>
                            <select id="prova-sel" data-testid="prova-sel">
                                <option value="">Selecione uma prova</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prova-esc">Escala</label>
                                <select id="prova-esc" data-testid="prova-esc">
                                    <option value="perc">Percentil</option>
                                    <option value="qi">QI</option>
                                    <option value="z">Nota Z</option>
                                    <option value="t">Nota T</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="prova-val">Valor</label>
                                <input type="number" id="prova-val" placeholder="25" data-testid="prova-val">
                            </div>
                        </div>
                        <div class="conversion-display" id="conversion-display">
                            <span class="conversion-label">Compet√™ncia:</span>
                            <span class="conversion-value" id="conversion-value">‚Äî</span>
                        </div>
                        <button class="btn btn-primary btn-block" id="btn-add-prova" data-testid="btn-add-prova">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14m-7-7h14"/></svg>
                            Adicionar Resultado
                        </button>
                        <div id="tarefas-container"></div>
                        <div id="prova-list" class="prova-list"></div>
                    </div>
                </div>
            </section>

            <!-- Ac√ß√µes -->
            <section class="card" id="card-acoes">
                <div class="card-body">
                    <button class="btn btn-primary btn-block btn-lg" id="btn-gerar" data-testid="btn-gerar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                        Gerar Perfil
                    </button>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="btn-limpar" title="Limpar (Ctrl+L)" data-testid="btn-limpar">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                            Limpar
                        </button>
                        <button class="btn btn-secondary" id="btn-exemplo" title="Carregar Exemplo (E)" data-testid="btn-exemplo">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8m2-8H8"/></svg>
                            Exemplo
                        </button>
                        <button class="btn btn-secondary" id="btn-export" title="Exportar (Ctrl+E)" data-testid="btn-export">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                            Exportar
                        </button>
                    </div>
                </div>
            </section>
        </aside>

        <!-- Main Content Area -->
        <section class="content">
            <!-- Radar Chart -->
            <div class="radar-card" id="radar-card">
                <div class="radar-header">
                    <div class="radar-title-wrap">
                        <h2 id="radar-title">Perfil de Compet√™ncia Lingu√≠stica</h2>
                        <span class="radar-subtitle" id="radar-subtitle"></span>
                    </div>
                    <div class="radar-actions">
                        <button class="btn-icon btn-sm btn-close-fullscreen" id="btn-close-fullscreen" title="Sair do Ecr√£ Completo (ESC)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                        </button>
                        <button class="btn-icon btn-sm" id="btn-zoom-in" title="Ampliar">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35M11 8v6m-3-3h6"/></svg>
                        </button>
                        <button class="btn-icon btn-sm" id="btn-zoom-out" title="Reduzir">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35M8 11h6"/></svg>
                        </button>
                        <button class="btn-icon btn-sm" id="btn-download-png" title="Descarregar PNG">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                        </button>
                    </div>
                </div>
                <div class="radar-body">
                    <div class="radar-wrap" id="radar-wrap">
                        <canvas id="radar-canvas" width="800" height="800"></canvas>
                    </div>
                </div>
                <div class="radar-legend">
                    <div class="legend-section">
                        <h4>Zonas de Refer√™ncia</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="legend-color zone-red"></span>
                                <span>0-3: Dificuldade Significativa</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color zone-yellow"></span>
                                <span>3-5: Dificuldade Prov√°vel</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color zone-white"></span>
                                <span>5-10: Desempenho T√≠pico</span>
                            </div>
                        </div>
                    </div>
                    <div class="legend-section">
                        <h4>An√©is Hier√°rquicos</h4>
                        <div class="legend-items">
                            <div class="legend-item"><span class="legend-color" style="background:var(--caidi-turquesa)"></span><span>Dom√≠nio Lingu√≠stico</span></div>
                            <div class="legend-item"><span class="legend-color" style="background:#A5D6A7"></span><span>N√≠vel de Processamento</span></div>
                            <div class="legend-item"><span class="legend-color" style="background:#90CAF9"></span><span>Circuito</span></div>
                            <div class="legend-item"><span class="legend-color" style="background:#E0E0E0"></span><span>Modalidade</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Dashboard -->
            <div class="stats-dashboard" id="stats-dashboard" style="display:none">
                <h3 class="section-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
                    Resumo Estat√≠stico
                </h3>
                <div class="stats-grid" id="stats-grid"></div>
            </div>

            <!-- Analysis Panel -->
            <div class="analysis-panel" id="analysis" style="display:none">
                <h3 class="section-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                    An√°lise Cl√≠nica
                </h3>
                
                <div class="analysis-section">
                    <h4>Padr√µes Identificados</h4>
                    <div id="patterns"></div>
                </div>
                
                <div class="analysis-section">
                    <h4>Hip√≥teses Diagn√≥sticas</h4>
                    <div class="disclaimer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><path d="M12 9v4m0 4h.01"/></svg>
                        Estas hip√≥teses requerem confirma√ß√£o atrav√©s de avalia√ß√£o cl√≠nica completa.
                    </div>
                    <div id="hypotheses"></div>
                </div>
                
                <div class="analysis-section">
                    <h4>Prioridades de Interven√ß√£o</h4>
                    <div id="intervention"></div>
                    <button class="btn btn-sm btn-ia" id="btn-abrir-ia" style="margin-top:1rem">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                        ü§ñ Gerar Plano com IA
                    </button>
                </div>

                <div class="analysis-section">
                    <h4>Perfil por Dimens√£o</h4>
                    <div id="dimension-charts"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <img src="logo.png" alt="CAIDI" class="footer-logo">
                <div class="footer-text">
                    <p><strong>Perfil de Compet√™ncia Lingu√≠stica</strong></p>
                    <p>Baseado nos Quadrantes de Alves (2019)</p>
                </div>
            </div>
            <div class="footer-center">
                <p>Desenvolvido por <strong>Joana Miguel</strong></p>
                <p>CAIDI - Centro de Apoio e Interven√ß√£o no Desenvolvimento Infantil</p>
            </div>
            <div class="footer-right">
                <p class="version">v3.0</p>
                <p>Agosto 2025</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 CAIDI ¬∑ Todos os direitos reservados</p>
            <p class="shortcuts-hint">Atalhos: <kbd>G</kbd> Gerar ¬∑ <kbd>E</kbd> Exemplo ¬∑ <kbd>T</kbd> Tema ¬∑ <kbd>H</kbd> Hist√≥rico ¬∑ <kbd>F</kbd> Ecr√£ completo</p>
        </div>
    </footer>

    <!-- Modals -->
    <!-- History Modal -->
    <div class="modal" id="modal-history">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    Hist√≥rico de Casos
                </h2>
                <button class="btn-close" data-close-modal>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="history-actions">
                    <input type="text" id="history-search" placeholder="Pesquisar casos..." class="search-input">
                    <button class="btn btn-secondary" id="btn-import-json">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 002-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                        Importar
                    </button>
                    <button class="btn btn-secondary" id="btn-export-all">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Exportar Todos
                    </button>
                </div>
                <div id="history-list" class="history-list"></div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="modal-info">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></svg>
                    Informa√ß√µes
                </h2>
                <button class="btn-close" data-close-modal>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="info-tabs">
                    <button class="info-tab active" data-info="provas">L√©xico de Provas</button>
                    <button class="info-tab" data-info="conversao">Tabela de Convers√£o</button>
                    <button class="info-tab" data-info="modelo">Modelo Te√≥rico</button>
                    <button class="info-tab" data-info="atalhos">Atalhos</button>
                </div>
                <div id="info-content" class="info-content"></div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="modal-export">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                    Exportar Perfil
                </h2>
                <button class="btn-close" data-close-modal>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <button class="export-option" data-export="png">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                        <span>PNG</span>
                        <small>Imagem do radar</small>
                    </button>
                    <button class="export-option" data-export="pdf">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8m2-8H8"/></svg>
                        <span>Relat√≥rio</span>
                        <small>Relat√≥rio completo</small>
                    </button>
                    <button class="export-option" data-export="json">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/></svg>
                        <span>JSON</span>
                        <small>Dados estruturados</small>
                    </button>
                    <button class="export-option" data-export="csv">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M8 13h2m4 0h2M8 17h2m4 0h2"/></svg>
                        <span>CSV</span>
                        <small>Folha de c√°lculo</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Login/Registo -->
    <div class="modal" id="modal-auth">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="auth-title">Entrar</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-auth="login">Entrar</button>
                    <button class="auth-tab" data-auth="register">Criar Conta</button>
                </div>
                <form id="auth-form">
                    <div class="form-group" id="auth-nome-group" style="display:none">
                        <label>Nome</label>
                        <input type="text" id="auth-nome" placeholder="O seu nome">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="auth-email" placeholder="email@exemplo.com" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="form-error" id="auth-error"></div>
                    <button type="submit" class="btn btn-primary btn-block" id="auth-submit">Entrar</button>
                </form>
                <p class="auth-info">
                    <small>Os seus dados ficam guardados de forma segura no servidor.</small>
                </p>
            </div>
        </div>
    </div>

    <!-- Modal Dashboard -->
    <div class="modal" id="modal-dashboard">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>Dashboard</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="dashboard-stats" id="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="stat-total-casos">0</div>
                        <div class="stat-label">Total de Casos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value" id="stat-casos-mes">0</div>
                        <div class="stat-label">Este M√™s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-value" id="stat-media-comp">-</div>
                        <div class="stat-label">M√©dia Compet√™ncias</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-value" id="stat-provas-custom">0</div>
                        <div class="stat-label">Provas Custom</div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h4>Casos Recentes</h4>
                    <div class="casos-grid" id="casos-recentes"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Prova Aplicada -->
    <div class="modal" id="modal-editar-prova">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Prova Aplicada</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Prova</label>
                    <input type="text" id="edit-prova-nome" readonly class="input-readonly">
                </div>
                <div class="form-group">
                    <label>Valor Obtido</label>
                    <input type="number" id="edit-prova-valor" step="0.1">
                </div>
                <div class="form-group">
                    <label>Escala</label>
                    <select id="edit-prova-escala">
                        <option value="z">Pontua√ß√£o Z</option>
                        <option value="t">Pontua√ß√£o T</option>
                        <option value="pc">Percentil</option>
                        <option value="pe">Pontua√ß√£o Escalar</option>
                        <option value="qi">QI/Standard</option>
                        <option value="comp">Compet√™ncia (0-10)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Compet√™ncia Calculada</label>
                    <input type="text" id="edit-prova-comp" readonly class="input-readonly">
                </div>
                <input type="hidden" id="edit-prova-idx">
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-close>Cancelar</button>
                    <button class="btn btn-primary" id="btn-salvar-edicao-prova">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Prova Custom -->
    <div class="modal" id="modal-editar-prova-custom">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Editar Prova Personalizada</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome da Prova</label>
                        <input type="text" id="edit-custom-nome" placeholder="Ex: Prova de Nomea√ß√£o">
                    </div>
                    <div class="form-group">
                        <label>Escala</label>
                        <select id="edit-custom-escala">
                            <option value="z">Pontua√ß√£o Z</option>
                            <option value="t">Pontua√ß√£o T</option>
                            <option value="pc">Percentil</option>
                            <option value="pe">Pontua√ß√£o Escalar</option>
                            <option value="qi">QI/Standard</option>
                            <option value="comp">Compet√™ncia (0-10)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Dom√≠nio Principal</label>
                    <select id="edit-custom-dominio">
                        <option value="Fonol√≥gico">Fonol√≥gico</option>
                        <option value="Morfol√≥gico">Morfol√≥gico</option>
                        <option value="Sint√°tico">Sint√°tico</option>
                        <option value="Sem√¢ntico">Sem√¢ntico</option>
                        <option value="Pragm√°tico">Pragm√°tico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Segmentos Avaliados</label>
                    <div class="segmentos-grid" id="edit-custom-segmentos"></div>
                </div>
                <input type="hidden" id="edit-custom-id">
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-close>Cancelar</button>
                    <button class="btn btn-danger" id="btn-eliminar-prova-custom">Eliminar</button>
                    <button class="btn btn-primary" id="btn-salvar-prova-custom">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gerar Plano IA -->
    <div class="modal" id="modal-ia">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>ü§ñ Plano Terap√™utico com IA</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="ia-intro">
                    <p>O sistema ir√° analisar o perfil lingu√≠stico e gerar um plano terap√™utico personalizado. <strong>Nota:</strong> Esta funcionalidade requer configura√ß√£o adicional.</p>
                </div>
                <div class="form-group">
                    <label>Contexto Adicional (opcional)</label>
                    <textarea id="ia-contexto" rows="3" placeholder="Informa√ß√µes adicionais relevantes: hist√≥ria cl√≠nica, observa√ß√µes, objectivos espec√≠ficos da fam√≠lia..."></textarea>
                </div>
                <div class="ia-loading" id="ia-loading" style="display:none">
                    <div class="loading-spinner"></div>
                    <p>A gerar plano terap√™utico...</p>
                </div>
                <div class="ia-result" id="ia-result" style="display:none"></div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" data-close>Cancelar</button>
                    <button class="btn btn-primary" id="btn-gerar-plano-ia">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm0 18a8 8 0 118-8 8 8 0 01-8 8z"/><path d="M12 6v6l4 2"/></svg>
                        Gerar Plano
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Compara√ß√£o Temporal -->
    <div class="modal" id="modal-comparacao">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>üìà Evolu√ß√£o Temporal</h3>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="comparacao-container" id="comparacao-container">
                    <p class="text-muted">Seleccione um caso com hist√≥rico para ver a evolu√ß√£o.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="js/supabase-client.js"></script>
    <script src="js/data.js"></script>
    <script src="js/radar.js"></script>
    <script src="js/app.js"></script>
</body>
</html>